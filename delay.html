<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wait Before Access</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .message {
            font-size: 1.5em;
            margin-bottom: 20px;
        }
        .countdown {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }
        .progress {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: conic-gradient(#4caf50 0% 0%, #ddd 0%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .progress::after {
            content: '';
            position: absolute;
            width: 80px;
            height: 80px;
            background: #f0f0f0;
            border-radius: 50%;
        }
        .hidden {
            display: none;
        }
        .proceed-btn {
            padding: 10px 20px;
            font-size: 1.2em;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .proceed-btn:disabled {
            background-color: #aaa;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="message">Why am I checking?</div>
    <div class="progress">
        <span class="countdown">0</span>
    </div>
    <button class="proceed-btn hidden" disabled>Proceed</button>

    <script>
        function getQueryParam(param, isString = false) {
            const urlParams = new URLSearchParams(window.location.search);
            if (isString) {
                return urlParams.get(param) || ''; // Return string directly
            }
            return parseInt(urlParams.get(param)) || 10; // Default for numbers
        }
        
        let timeLeft = getQueryParam('S'); // Get delay time
        let redirectUrl = getQueryParam('U', true); // Get blocked URL
        
        // Use localStorage instead of sessionStorage to persist state across reloads
        const delayKey = `delayCompleted_${redirectUrl}`;
        
        if (localStorage.getItem(delayKey)) {
            window.location.href = redirectUrl;
        } else {
            localStorage.setItem(delayKey, "true"); // Mark as delayed
        }
        
        const countdownElement = document.querySelector('.countdown');
        const progressElement = document.querySelector('.progress');
        const proceedButton = document.querySelector('.proceed-btn');
        const totalTime = timeLeft;
        
        function updateUI() {
            countdownElement.textContent = timeLeft;
            let progressPercentage = ((totalTime - timeLeft) / totalTime) * 100;
            progressElement.style.background = `conic-gradient(#4caf50 ${progressPercentage}%, #ddd ${progressPercentage}%)`;
        }
        
        function startCountdown() {
            updateUI();
            const timer = setInterval(() => {
                timeLeft--;
                updateUI();
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    proceedButton.classList.remove('hidden');
                    proceedButton.disabled = false;
                }
            }, 1000);
        }
        
        proceedButton.addEventListener('click', () => {
            window.location.href = redirectUrl || 'https://duckduckgo.com';
        });
        
        startCountdown();
    </script>
</body>
</html>
